<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Tunjo Wishes WordCloud</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-wordcloud"></script>
  <style>
    body { 
      font-family: Arial, sans-serif; 
      background: #f2f7f3; 
      text-align: center; 
      padding: 20px; 
    }
    h1 { color: #2c6e49; }
    #counter { font-size: 1.2em; margin: 15px 0; color: #444; }
    canvas { width: 100%; height: 80vh; }
  </style>
</head>
<body>
  <h1>ðŸŒ± Nuestro deseo unido de un futuro sostenible</h1>
  <p id="counter">Cargando deseos...</p>
  <canvas id="wordCloud"></canvas>

  <script>
    async function loadData() {
      const sheetId = "1bATo8gpOfsV3_HgRbwnYnmteOFxh77sjqt2gpYkuuBk"; 
      const apiKey = "AIzaSyABzLxdigSjc8S2hii4bGv42XnTE_gNyzc"; 
      const range = "Sheet1!D2:D"; // D column = Wishes

      const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}`;
      const response = await fetch(url);
      const data = await response.json();

      if (!data.values) return { words: [], total: 0 };

      // Extract wishes
      const wishes = data.values.map(row => row[0]);
      const total = wishes.length;

      // Flatten wishes into words
      const words = wishes.join(" ").split(/\s+/);

      // Count frequency
      const counts = {};
      words.forEach(w => {
        const word = w.toLowerCase().replace(/[^a-zÃ¡Ã©Ã­Ã³ÃºÃ¼Ã±]/gi, ""); // clean
        if (word.length > 3) { // ignore short words
          counts[word] = (counts[word] || 0) + 1;
        }
      });

      return { 
        words: Object.entries(counts).map(([text, weight]) => ({ text, weight })), 
        total 
      };
    }

    loadData().then(result => {
      // Update counter
      document.getElementById("counter").textContent = `âœ¨ Total de deseos hasta ahora: ${result.total}`;

      // Draw WordCloud
      new Chart(document.getElementById("wordCloud"), {
        type: "wordCloud",
        data: {
          labels: result.words.map(w => w.text),
          datasets: [{
            label: "Deseos Sostenibles",
            data: result.words.map(w => w.weight),
          }]
        },
        options: {
          plugins: { legend: { display: false } }
        }
      });
    });
  </script>
</body>
</html>
