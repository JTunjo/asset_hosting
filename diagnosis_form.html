<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Encuesta - Prototipo Café</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: sans-serif;
      background: #f9fafb;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }
    .survey-container {
      background: white;
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      max-width: 500px;
      width: 100%;
    }
    .question {
      margin-bottom: 1.5rem;
    }
    input, textarea {
      width: 100%;
      padding: 0.5rem;
      box-sizing: border-box;
      margin-top: 0.3rem;
    }
    button {
      padding: 0.6rem 1rem;
      background: #2563eb;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    button:hover {
      background: #1d4ed8;
    }
    .hidden {
      display: none;
    }
    label {
      display: block;
      margin-top: 0.3rem;
    }
    .question label {
      display: flex;
      align-items: center;      /* centra verticalmente checkbox y texto */
      gap: 0.5rem;              /* espacio entre checkbox y texto */
      margin-top: 0.5rem;       /* espacio entre cada opción */
    }
    
    .question label input[type="checkbox"] {
      flex-shrink: 0;        /* evita que el checkbox se reduzca */
      width: 18px;            /* ancho fijo del checkbox */
      height: 18px;           /* altura fija del checkbox */
    }
    
    .question label span {
      flex: 1;                   /* el texto ocupa todo el espacio restante */
      margin-left: 0.3rem;
      word-break: break-word;    /* permite que el texto largo se rompa en varias líneas */
    }

    .spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(0, 0, 0, 0.1);
      border-top-color: #2563eb;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      vertical-align: middle;
      margin-left: 8px;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header style="background:#2563eb; color:white; text-align:center; padding:1rem; position:relative;">
    <div style="position:absolute; top:0.5rem; left:50%; transform:translateX(-50%);">
      <img src="Tunjo_bw.png" alt="Tunjo Logo" style="height:40px;"/>
    </div>
    <h1 style="margin:0; font-size:1.5rem;">Encuesta Procesamiento Café IOT</h1>
  </header>

  <div style="display:flex; justify-content:center; margin-top:100px; margin-bottom:80px; padding:1rem;">
    <div class="survey-container" style="width:100%; max-width:500px;">
      <!-- q1 -->
      <div class="question-page" id="page-1" data-param="q1">
        <h2>Nombre del Proyecto/Organización</h2>
        <div class="question">
          <input type="text" name="q1" placeholder="Escribe aquí tu respuesta"/>
        </div>
        <button onclick="nextPage()">Siguiente</button>
      </div>
  
      <!-- q2 -->
      <div class="question-page hidden" id="page-2" data-param="q2">
        <h2>Por favor describa brevemente los problemas que tiene actualmente con el procesamiento de café</h2>
        <div class="question">
          <textarea name="q2" rows="4" placeholder="Escribe aquí tu respuesta"></textarea>
        </div>
        <button onclick="nextPage()">Siguiente</button>
      </div>
  
      <!-- q3 -->
      <div class="question-page hidden" id="page-3" data-param="q3">
        <h2>Objetivo de la implementación, ¿Qué buscamos mejorar en cifras?</h2>
        <div class="question">
          <textarea name="q3" rows="4" placeholder="Escribe aquí tu respuesta"></textarea>
        </div>
        <button onclick="nextPage()">Siguiente</button>
      </div>
  
      <!-- q4 -->
      <div class="question-page hidden" id="page-4" data-param="q4">
        <h2>Cantidad total de café a procesar, por cosecha</h2>
        <div class="question">
          <input type="number" name="q4" placeholder="Kg"/>
        </div>
        <button onclick="nextPage()">Siguiente</button>
      </div>
  
      <!-- q5 -->
      <div class="question-page hidden" id="page-5" data-param="q5">
        <h2>Cantidad de café a procesar por lote, Café máximo a llenar en Marquesina o en biorreactores</h2>
        <div class="question">
          <input type="number" name="q5" placeholder="Kg"/>
        </div>
        <button onclick="nextPage()">Siguiente</button>
      </div>
  
      <!-- q6 -->
      <div class="question-page hidden" id="page-6" data-param="q6">
        <h2>Perfil deseado de Proceso</h2>
        <div class="question">
          <label></span><input type="checkbox" name="q6" value="Lavado"><span>Lavado</span></label>
          <label><input type="checkbox" name="q6" value="Honey"> <span>Honey</span></label>
          <label><input type="checkbox" name="q6" value="Natural"><span>Natural</span></label>
        </div>
        <button onclick="nextPage()">Siguiente</button>
      </div>
  
      <!-- q7 -->
      <div class="question-page hidden" id="page-7" data-param="q7">
        <h2>Perfil deseado de sabor</h2>
        <div class="question">
          <label><input type="checkbox" name="q7" value="Terroir (Lavados y Fermentación Espontánea)"> Terroir (Lavados y Fermentación Espontánea)</label>
          <label><input type="checkbox" name="q7" value="Oxidaciones y Fermentaciones Inoculadas o Maceración Carbónica"> Oxidaciones y Fermentaciones Inoculadas o Maceración Carbónica</label>
          <label><input type="checkbox" name="q7" value="Cofermentación"> Cofermentación</label>
          <label><input type="checkbox" name="q7" value="Infusión"> Infusión</label>
        </div>
        <button onclick="nextPage()">Siguiente</button>
      </div>
  
      <!-- q8 -->
      <div class="question-page hidden" id="page-8" data-param="q8">
        <h2>¿Cuál es el mercado objetivo general para el café a procesar?</h2>
        <div class="question">
          <label><input type="checkbox" name="q8" value="Exportación - Exóticos"> Exportación - Exóticos</label>
          <label><input type="checkbox" name="q8" value="Exportación - Regionales"> Exportación - Regionales</label>
          <label><input type="checkbox" name="q8" value="Nacional - Exóticos"> Nacional - Exóticos</label>
          <label><input type="checkbox" name="q8" value="Nacional - Regionales y Espresso"> Nacional - Regionales y Espresso</label>
        </div>
        <button onclick="nextPage()">Siguiente</button>
      </div>
  
      <!-- q9 -->
      <div class="question-page hidden" id="page-9" data-param="q9">
        <h2>¿Ha realizado experimentos previos o avances del proyecto? En caso afirmativo, agregue comentario.</h2>
        <div class="question">
          <textarea name="q9" rows="4" placeholder="Escribe aquí tu respuesta"></textarea>
        </div>
        <button id="submit-btn" onclick="submitSurvey()">Enviar</button>
      </div>
  
      <!-- página final -->
      <div class="question-page hidden" id="page-10">
        <h2>¡Gracias por participar!</h2>
        <p>Tu respuesta ha sido registrada.</p>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer style="background:#f3f4f6; text-align:center; padding:1rem; position:fixed; bottom:0; width:100%; font-size:0.9rem; color:#374151;">
    Tunjo Smart Solutions, 2025 © Todos los derechos reservados
  </footer>

  
  <script>
    const endpoint = "https://script.google.com/macros/s/AKfycbwILfGGg_WBQfkGz_asScqwRRhvtsJ3sJNiB_kRcRyk8lIoAAXbSP9HIkL4EihUf6jM/exec";
    const pages = Array.from(document.querySelectorAll('.question-page')).filter(p => !p.id.includes('page-10'));
    let currentIndex = 0;
    showPage(currentIndex);

    function showPage(i){
      pages.forEach((p, idx) => p.classList.toggle('hidden', idx !== i));
    }

    function nextPage(){
      const page = pages[currentIndex];
      const param = page.dataset.param;
      if(param){
        // validación mínima para input/textarea
        const input = page.querySelector('input, textarea');
        if(input && !input.value.trim()){
          alert('Por favor responde la pregunta antes de continuar.');
          return;
        }
        // validación mínima para checkboxes
        const cbs = page.querySelectorAll('input[type="checkbox"]');
        if(cbs.length && ![...cbs].some(cb => cb.checked)){
          alert('Por favor selecciona al menos una opción.');
          return;
        }
      }
      if(currentIndex < pages.length -1){
        currentIndex++;
        showPage(currentIndex);
      }
    }

    function collectAnswers(){
      const result = {};
      pages.forEach(page=>{
        const key = page.dataset.param;
        if(!key) return;
        const cbs = page.querySelectorAll('input[type="checkbox"]:checked');
        if(cbs.length){
          result[key] = [...cbs].map(cb=>cb.value).join(', ');
          return;
        }
        const input = page.querySelector('input, textarea');
        if(input) result[key] = input.value.trim();
      });
      return result;
    }

    async function submitSurvey(){
      const btn = document.getElementById('submit-btn');
      // deshabilitar botón
      btn.disabled = true;
    
      // agregar spinner
      const spinner = document.createElement('span');
      spinner.className = 'spinner';
      btn.appendChild(spinner);
    
      const answers = collectAnswers();
      const qs = Object.keys(answers)
        .map(k => `${encodeURIComponent(k)}=${encodeURIComponent(answers[k]||'')}`)
        .join('&');
      const url = endpoint + '?' + qs;
    
      try {
        await fetch(url, {method:'GET'});
      } catch(e){
        console.error(e);
        alert("Ocurrió un error al enviar la encuesta.");
      }
    
      // ocultar todas las páginas y mostrar la página final
      document.querySelectorAll('.question-page').forEach(p=>p.classList.add('hidden'));
      document.getElementById('page-10').classList.remove('hidden');
    }

  </script>
</body>
</html>
